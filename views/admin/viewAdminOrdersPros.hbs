<!-- Start Banner Area -->
<section class="banner-area organic-breadcrumb">
  <div class="container">
    <div class="breadcrumb-banner d-flex flex-wrap align-items-center justify-content-end">
      <div class="col-first">
        <h1>My Orders</h1>
        <nav class="d-flex align-items-center">
          <a href="/">Home<span class="lnr lnr-arrow-right"></span></a>
          <a href="/my-order">My Orders</a>
        </nav>
      </div>
    </div>
  </div>
</section>
<!-- End Banner Area -->



{{!-- ----order details---- --}}
<section class="order_details section_gap">
  <div class="container  ">
    <div class=" pb-5">


      <div class="order_box row d-flex justify-content-center align-items-center h-100">
        <div class="col-lg-10 col-xl-8">
          <div class="card" style="border-radius: 10px;">

            <div class="card-body p-4">
              <div class="d-flex justify-content-between align-items-center mb-4">
                <p class="lead fw-normal mb-0" style="color: #ffa020;">Receipt</p>
                <p class="small text-muted mb-0">Receipt Voucher : {{order._id}}</p>
              </div>

              {{#each order.product}}
              <div class="card shadow-0 border mb-4">
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-2">
                      <img src="/uploads/{{pro_id.Images.[0].image1}}" class="img-fluid" alt="Phone">
                    </div>
                    <div class="col-md-3 text-center d-flex justify-content-center align-items-center">
                      <p class="text-muted mb-0">{{this.pro_id.Product_Name}}</p>
                    </div>
                    <div class="col-md-1 text-center d-flex justify-content-center align-items-center">
                      <p class="text-muted mb-0 small">x {{this.quantity}}</p>
                    </div>

                    <div class="col-md-1text-center d-flex justify-content-center align-items-center">
                      <p class="text-muted mb-0 small">₹{{this.subtotal}}</p>
                    </div>
                    <div class="col-md-3 text-center d-flex justify-content-center align-items-center">
                      <p class="text-muted mb-0 small">status : <span style="color:orangered"> {{this.status}}</span>
                      </p>
                    </div>
                    {{#if this.orderCancelled}}
                    {{else}}
                    <div class="col-md-2 text-center d-flex justify-content-center align-items-center">
                      <button class="btn btn-danger cancel-order" style="width: 120px; font-size: small ;"
                        onclick="cancelOrder('{{../order._id}}','{{this.pro_id._id}}','{{this.subtotal}}','{{../order.grandTotal}}','{{../order.couponPercentage}}','{{../order.reFund}}','{{this.quantity}}','{{../order.shippingCharges}}')">Cancel
                        Order</button>
                    </div>
                    {{/if}}


                  </div>
                  <hr class="mb-4" style="background-color: #e0e0e0; opacity: 0;">
                  <div class="row d-flex align-items-center">
                    {{!-- <div class="col-md-2">
                      <p class="text-muted mb-0 small">Track Order</p>
                    </div> --}}
                    {{!-- <div class="col-md-10">
                      <div class="progress" style="height: 6px; border-radius: 16px;">
                        <div class="progress-bar" role="progressbar"
                          style="width: 65%; border-radius: 16px; background-color: #ffcd87;" aria-valuenow="65"
                          aria-valuemin="0" aria-valuemax="100"></div>
                      </div>
                      <div class="d-flex justify-content-around mb-1">
                        <p class="text-muted mt-1 mb-0 small ms-xl-5">Out for delivary</p>
                        <p class="text-muted mt-1 mb-0 small ms-xl-5">Delivered</p>
                      </div>
                    </div> --}}
                  </div>
                </div>
              </div>

              {{/each}}


              <div class="d-flex justify-content-between pt-2">
                <p class="fw-bold mb-0"><span style="color:#83b1d0;">Order Details</span></p>
                <p class="text-muted mb-0"><span class="fw-bold me-4">Subtotal : </span> ₹ {{order.Total}}</p>
              </div>

              {{!-- <div class="d-flex justify-content-between pt-2">
                <p class="text-muted mb-0">Invoice Number : 788152</p>
                <p class="text-muted mb-0"><span class="fw-bold me-4">Discount</span> $19.00</p>
              </div> --}}

              <div class="d-flex justify-content-between">
                <p class="text-muted mb-0"><span class="fw-bold me-4">Invoice Date :</span> {{ordered_on}}</p>
                {{!-- <p class="text-muted mb-0"><span class="fw-bold me-4">GST 18%</span> 123</p> --}}
              </div>

              <div class="d-flex justify-content-between ">
                {{!-- <p class="text-muted mb-0">Recepits Voucher : 18KU-62IIK</p> --}}
                <p class="text-muted mb-0"><span class="fw-bold me-4">Shipping Charge : </span> ₹
                  {{order.shippingCharges}}</p>
              </div>
              <div class="d-flex justify-content-between ">
                {{!-- <p class="text-muted mb-0">Recepits Voucher : 18KU-62IIK</p> --}}
                <p class="text-muted mb-0"><span class="fw-bold me-4">Coupon Discount : </span> ₹
                  {{order.coupondiscountedPrice}}</p>
              </div>
              <div class="d-flex justify-content-between ">
                {{!-- <p class="text-muted mb-0">Recepits Voucher : 18KU-62IIK</p> --}}
                <p class="text-muted mb-0"><span class="fw-bold me-4">Refund : </span> ₹ {{order.grandTotal}}</p>
              </div>
              <div class="d-flex justify-content-between ">
                {{!-- <p class="text-muted mb-0">Recepits Voucher : 18KU-62IIK</p> --}}
                <p class="text-muted mb-0"><span class="fw-bold me-4">Grand Total : </span> ₹ {{order.grandTotal}}</p>
              </div>

            </div>
            <div class="card-footer border-0 px-4 py-5 "
              style="background-color: #ff8708; border-bottom-left-radius: 10px; border-bottom-right-radius: 10px;">
              <h5 class="d-flex align-items-center justify-content-end text-white text-uppercase mb-0">Total
                paid: <span class="h2 mb-0 ms-2"> ₹{{order.grandTotal}}</span></h5>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  {
    {
      !-- function cancelOrder(orderId, proId, subtotal, totalAmount, couponPercentage, reFund, quantity, shippingCharges) {
        Swal.fire({
          title: 'Are you sure?',
          text: "You won't be able to revert this!",
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#3085d6',
          cancelButtonColor: '#d33',
          confirmButtonText: 'Yes, cancel Order !'
        }).then((result) => {
          if (result.isConfirmed) {
            Swal.fire(
              'cancelOrder!',
              'Your Order has been canceled.',
              'success'
            ).then(() => {
              orderCancel()
            })
          }
        })

        function orderCancel() {
          $.ajax({
            url: '/cancel-order',
            data: {
              orderId: orderId,
              proId: proId,
              subtotal: subtotal,
              Total: totalAmount,
              couponPercentage: couponPercentage,
              reFund: reFund,
              quantity: quantity,
              shippingCharges: shippingCharges
            },
            method: 'post',
            success: (response) => {
              if (response.status) {
                location.reload()
              } else {
                location.href('/viewOrderProducts' + orderId)
              }
            }
          })
        }
      } --}
  }
</script>

<script>
  function cancelOrder(orderId, proId, subtotal, totalAmount, couponPercentage, reFund, quantity, shippingCharges) {
    $.ajax({
      url: '/cancel-order',
      data: {
        orderId: orderId,
        proId: proId,
        subtotal: subtotal,
        Total: totalAmount,
        couponPercentage: couponPercentage,
        reFund: reFund,
        quantity: quantity,
        shippingCharges: shippingCharges
      },
      method: 'post',
      success: (response) => {
        if (response.status) {
          location.reload()
        } else{
          
        }
      }
    })
  }
</script>